{% extends "base.html" %}

{% block title %}Homepage{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='homepage.css') }}">
{% endblock %}

{% block main %}
    <form action="{{ url_for('shop.filtered_results') }}" method="POST" id="filter-form">
        <!-- Barra di ricerca -->
        <div class="search-bar">
            <select name="selected_category_name">
                {% if not session['selected_category_name'] %}
                    <option selected="selected" value="">Tutte le categorie</option>
                {% else %}
                    <option value="{{session['selected_category_name']}}">{{session['selected_category_name']}}</option>
                    <option value="">Tutte le categorie</option>
                {% endif %} 

                {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
            </select>

            <input type="text" name="query" placeholder="Cerca prodotto..." value="{{ request.form.get('query', '') }}">
            <button type="submit">Cerca</button>
        </div>
        
        <!-- Opzioni di filtro migliorate -->
        <div class="filter-options">

            <!-- Filtro per prezzo -->
            <div class="price-range">
                <h4>Filtra per Prezzo</h4>
                <label for="minPriceRange">Prezzo minimo: <span id="minPriceValue">{{ session['min_price'] or 0 }}</span> €</label><br>
                <!--<input type="range" id="minPriceRange" name="minPriceRange" min="0" max="1000" step="10" value="{{ session['min_price'] or 0 }}" oninput="updatePriceValues()"><br>-->
                <input type="range" id="minPriceRange" name="minPriceRange" min="0" max="1000" step="10" value="{{ session['min_price'] or 0 }}" oninput="updatePriceValues()"><br>

                <label for="maxPriceRange">Prezzo massimo: <span id="maxPriceValue">{{ session['max_price'] or 6000 }}</span> €</label><br>
                <input type="range" id="maxPriceRange" name="maxPriceRange" min="0" max="6000" step="100" value="{{ session['max_price'] or 6000 }}" oninput="updatePriceValues()"><br>
            </div>

            <!-- Azioni del filtro -->
            <div class="filter-actions">
                <button type="submit">Applica Filtri</button>
                <a href="{{ url_for('shop.reset_filters') }}">Reset</a>
            </div>
        </div>
            <!--<h3>Prodotti in sessione</h3>
            {% for p in products %}
                <p>{% if p.id in session['selected_products'] %} {{ p.name }}{% endif %}</p>
            {% endfor %}
            <h3>Categoria in sessione</h3>
                <p>{{session['selected_category_name'] }}</p>-->
    </form>
    <h1>Prodotti</h1>
    <div class="product-grid">
        {% for p in products %}
            <div class="product">
                <a href="{{ url_for('product.access_product', product_id=p.id) }}" class="product-link"><img src="{{ p.image_url }}" alt="{{ p.name }}" height="50" width="50"></a>
                <p class="product-name">{{ p.name }}</p>
                <p class = "product-category"> {{ p.category.name }}</p>
                <p class="product-price">€{{ p.price }}</p>
                <a href="{{ url_for('cart.add_to_cart', product_id=p.id) }}">Aggiungi al carrello</a>
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // Funzione per aggiornare il valore visualizzato dei range input
        function updatePriceValues() {
            document.getElementById('minPriceValue').textContent = document.getElementById('minPriceRange').value;
            document.getElementById('maxPriceValue').textContent = document.getElementById('maxPriceRange').value;
        }
        updatePriceValues();
    </script>
{% endblock %}